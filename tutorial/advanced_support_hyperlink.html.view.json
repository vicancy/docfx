{"_lang":"csharp","_tocPath":"tutorial/toc.html","_navPath":"toc.html","_rel":"../","_path":"tutorial/advanced_support_hyperlink.html","_navRel":"../toc.html","_tocRel":"toc.html","_navKey":"~/../toc.yml","_tocKey":"~/../tutorial/toc.yml","conceptual":"\n<p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"4\" sourceendlinenumber=\"4\">In this topic, we will support hyperlinking in rtf files.</p>\n<p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"6\" sourceendlinenumber=\"6\">Create a hyperlink in the rtf file:</p>\n<ol sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"7\" sourceendlinenumber=\"10\">\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"7\" sourceendlinenumber=\"7\">Open <code>foo.rtf</code> by <code>Word</code>.</li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"8\" sourceendlinenumber=\"8\">Add a hyperlink in content</li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"9\" sourceendlinenumber=\"9\">Set the link target to an existing <code>bar.rtf</code></li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"10\" sourceendlinenumber=\"10\">Save the document.</li>\n</ol>\n<h2 id=\"about-link\" sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"12\" sourceendlinenumber=\"13\">About link</h2>\n<p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"14\" sourceendlinenumber=\"14\">An author can write any valid hyperlink in the document, and then needs to run <code>DocFX build</code> to update file links.</p>\n<h3 id=\"what-is-file-link\" sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"16\" sourceendlinenumber=\"16\">What is file link:</h3>\n<ol sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"17\" sourceendlinenumber=\"20\">\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"17\" sourceendlinenumber=\"19\">The hyperlink must be a relative path and not rooted.<ul sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"18\" sourceendlinenumber=\"19\">\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"18\" sourceendlinenumber=\"18\">valid: <code>foo\\bar.rtf</code>, <code>../foobar.rtf</code></li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"19\" sourceendlinenumber=\"19\">invalid: <code>/foo.rtf</code>, <code>c:\\foo\\bar.rtf</code>, <code>http://foo.bar/</code>, <code>mailto:foo@bar.foobar</code></li>\n</ul>\n</li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"20\" sourceendlinenumber=\"20\">The file must exist.</li>\n</ol>\n<h3 id=\"why-update-file-link\" sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"22\" sourceendlinenumber=\"22\">Why update file link:</h3>\n<p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"24\" sourceendlinenumber=\"24\">The story is:</p>\n<ol sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"25\" sourceendlinenumber=\"28\">\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"25\" sourceendlinenumber=\"25\">In <code>foo.rtf</code>, it has a file link to <code>bar.rtf</code>.</li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"26\" sourceendlinenumber=\"26\">In document build, <code>bar.rtf</code> generates a file with the name <code>bar.html</code>.</li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"27\" sourceendlinenumber=\"27\">But in <code>foo.rtf</code>, the link target is still <code>bar.rtf</code>, thus in the output folder we cannot find this file and we will get a broken link.</li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"28\" sourceendlinenumber=\"28\">To resolve the broken link, we need to update the link target from <code>bar.rtf</code> to <code>bar.html</code>.</li>\n</ol>\n<p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"30\" sourceendlinenumber=\"31\">File link is a relative path, but we cannot track the relative path easily.\nSo we track the <em>normalized file path</em> instead.</p>\n<h3 id=\"what-is-a-normalized-file-path\" sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"33\" sourceendlinenumber=\"33\">What is a <em>normalized file path</em>:</h3>\n<ol sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"34\" sourceendlinenumber=\"38\">\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"34\" sourceendlinenumber=\"34\">It always starts from the working folder (the folder that contains <code>docfx.json</code>), and we write it as <code>~/</code>.</li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"35\" sourceendlinenumber=\"35\">No <code>../</code> or <code>./</code> or <code>//</code></li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"36\" sourceendlinenumber=\"36\">Replace <code>\\</code> with <code>/</code>.</li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"37\" sourceendlinenumber=\"37\">No url encoding. The path must be same as it in the file system.</li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"38\" sourceendlinenumber=\"38\">No anchor.</li>\n</ol>\n<p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"40\" sourceendlinenumber=\"40\">Finally, a valid <em>normalized file path</em> looks like: <code>~/foo/bar.rtf</code>.</p>\n<ul sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"42\" sourceendlinenumber=\"59\">\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"42\" sourceendlinenumber=\"56\"><p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"42\" sourceendlinenumber=\"42\">Pros</p>\n<ul sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"43\" sourceendlinenumber=\"56\">\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"43\" sourceendlinenumber=\"52\"><p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"43\" sourceendlinenumber=\"43\">Same form in different documents when the target is the same file.</p>\n<p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"45\" sourceendlinenumber=\"45\">When file structure is:</p>\n<pre sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"46\" sourceendlinenumber=\"50\"><code>z:\\a\\b\\foo.rtf\nz:\\a\\b\\c\\bar.rtf\nz:\\a\\b\\c\\foobar.rtf\n</code></pre><p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"51\" sourceendlinenumber=\"52\">Link target <code>c/foobar.rtf</code> in <code>foo.rtf</code> and link target <code>foobar.rtf</code> in <code>bar.rtf</code> is the same file.\nWhen the working folder is <code>z:\\a\\</code>, the link target is always <code>~/b/c/foobar.rtf</code>.</p>\n</li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"54\" sourceendlinenumber=\"56\"><p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"54\" sourceendlinenumber=\"54\">Avoids differences in style when referring to the same file.</p>\n<p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"56\" sourceendlinenumber=\"56\">For example, the following hyperlinks target the same file: <code>a/foo.rtf</code>, <code>./a/foo.rtf</code>, <code>a/b/../foo.rtf</code>, <code>a//foo.rtf</code>, <code>a\\foo.rtf</code></p>\n</li>\n</ul>\n</li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"58\" sourceendlinenumber=\"59\"><p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"58\" sourceendlinenumber=\"58\">Cons</p>\n<ul sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"59\" sourceendlinenumber=\"59\">\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"59\" sourceendlinenumber=\"59\">A folder with the name <code>~</code> is not supported.</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"prepare\" sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"61\" sourceendlinenumber=\"62\">Prepare</h2>\n<ol sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"63\" sourceendlinenumber=\"69\">\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"63\" sourceendlinenumber=\"63\"><p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"63\" sourceendlinenumber=\"63\">Open the rtf plug-in library project in <code>Visual Studio</code>.</p>\n</li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"65\" sourceendlinenumber=\"66\"><p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"65\" sourceendlinenumber=\"66\">Add nuget packages:<br>for plug-in: <code>Microsoft.DocAsCode.Utility</code></p>\n</li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"68\" sourceendlinenumber=\"69\"><p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"68\" sourceendlinenumber=\"69\">Add framework assembly reference:\n<code>System.Core</code>, <code>System.Web</code>, <code>System.Xml.Linq</code></p>\n</li>\n</ol>\n<h2 id=\"update-rtf-document-processor\" sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"71\" sourceendlinenumber=\"72\">Update rtf document processor</h2>\n<ol sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"73\" sourceendlinenumber=\"82\">\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"73\" sourceendlinenumber=\"76\"><p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"73\" sourceendlinenumber=\"73\">Following the rules for hyperlink, add a <code>FixLink</code> help method:</p>\n<pre><code class=\"lang-csharp\" name=\"FixLink\">private static void FixLink(XAttribute link, RelativePath filePath, HashSet&lt;string&gt; linkToFiles)\n{\n    string linkFile;\n    string anchor = null;\n    if (PathUtility.IsRelativePath(link.Value))\n    {\n        var index = link.Value.IndexOf(&#39;#&#39;);\n        if (index == -1)\n        {\n            linkFile = link.Value;\n        }\n        else if (index == 0)\n        {\n            return;\n        }\n        else\n        {\n            linkFile = link.Value.Remove(index);\n            anchor = link.Value.Substring(index);\n        }\n        var path = filePath + (RelativePath)linkFile;\n        var file = (string)path.GetPathFromWorkingFolder();\n        link.Value = file + anchor;\n        linkToFiles.Add(HttpUtility.UrlDecode(file));\n    }\n}\n</code></pre><p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"76\" sourceendlinenumber=\"76\"><code>RelativePath</code> helps us generate the links correctly.</p>\n</li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"78\" sourceendlinenumber=\"79\"><p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"78\" sourceendlinenumber=\"78\">Then add <code>CollectLinksAndFixDocument</code> method:</p>\n<pre><code class=\"lang-csharp\" name=\"CollectLinksAndFixDocument\">private static HashSet&lt;string&gt; CollectLinksAndFixDocument(FileModel model)\n{\n    string content = (string)((Dictionary&lt;string, object&gt;)model.Content)[&quot;conceptual&quot;];\n    var doc = XDocument.Parse(content);\n    var links =\n        from attr in doc.Descendants().Attributes()\n        where &quot;href&quot;.Equals(attr.Name.LocalName, StringComparison.OrdinalIgnoreCase) || &quot;src&quot;.Equals(attr.Name.LocalName, StringComparison.OrdinalIgnoreCase)\n        select attr;\n    var path = (RelativePath)model.File;\n    var linkToFiles = new HashSet&lt;string&gt;();\n    foreach (var link in links)\n    {\n        FixLink(link, path, linkToFiles);\n    }\n    using (var sw = new StringWriter())\n    {\n        doc.Save(sw);\n        ((Dictionary&lt;string, object&gt;)model.Content)[&quot;conceptual&quot;] = sw.ToString();\n    }\n    return linkToFiles;\n}\n</code></pre></li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"81\" sourceendlinenumber=\"82\"><p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"81\" sourceendlinenumber=\"81\">Modify <code>Save</code> method with report links:</p>\n<pre><code class=\"lang-csharp\" name=\"Save\">public SaveResult Save(FileModel model)\n{\n    HashSet&lt;string&gt; linkToFiles = CollectLinksAndFixDocument(model);\n\n    return new SaveResult\n    {\n        DocumentType = &quot;Conceptual&quot;,\n        ModelFile = model.File,\n        LinkToFiles = linkToFiles.ToImmutableArray(),\n    };\n}\n</code></pre></li>\n</ol>\n<!-- todo : `Update Reference` is preserved for next version of plugin. -->\n\n<p sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"86\" sourceendlinenumber=\"86\">View final <a href=\"../codesnippet/Rtf/Hyperlink/RtfDocumentProcessor.cs\" data-raw-source=\"[RtfDocumentProcessor.cs](../codesnippet/Rtf/Hyperlink/RtfDocumentProcessor.cs)\" sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"86\" sourceendlinenumber=\"86\">RtfDocumentProcessor.cs</a></p>\n<h2 id=\"test-and-verify\" sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"89\" sourceendlinenumber=\"90\">Test and verify</h2>\n<ol sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"91\" sourceendlinenumber=\"95\">\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"91\" sourceendlinenumber=\"91\">Build project.</li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"92\" sourceendlinenumber=\"92\">Copy dll to <code>Plugins</code> folder.</li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"93\" sourceendlinenumber=\"93\">Modify rtf file, create hyperlink, link to another rtf file, and save.</li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"94\" sourceendlinenumber=\"94\">Build with command <code>DocFX build</code>.</li>\n<li sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"95\" sourceendlinenumber=\"95\">Verify output html file.</li>\n</ol>\n","type":"Conceptual","source":{"remote":{"path":"Documentation/tutorial/advanced_support_hyperlink.md","branch":"doc","repo":"https://github.com/dotnet/docfx.git"},"startLine":0.0,"endLine":0.0,"isExternal":false},"path":"../tutorial/advanced_support_hyperlink.md","documentation":{"remote":{"path":"Documentation/tutorial/advanced_support_hyperlink.md","branch":"doc","repo":"https://github.com/dotnet/docfx.git"},"startLine":0.0,"endLine":0.0,"isExternal":false},"_docfxVersion":"2.15.0.424","_systemKeys":["conceptual","type","source","path","documentation","title","rawTitle","wordCount"],"title":"🔧 Advanced: Support Hyperlink","rawTitle":"<h1 id=\"-advanced-support-hyperlink\" sourcefile=\"../tutorial/advanced_support_hyperlink.md\" sourcestartlinenumber=\"1\" sourceendlinenumber=\"2\">🔧 Advanced: Support Hyperlink</h1>","wordCount":572.0,"__global":{"classesInSubtitle":"Classes","structsInSubtitle":"Structs","interfacesInSubtitle":"Interfaces","enumsInSubtitle":"Enums","delegatesInSubtitle":"Delegates","constructorsInSubtitle":"Constructors","fieldsInSubtitle":"Fields","propertiesInSubtitle":"Properties","methodsInSubtitle":"Methods","eventsInSubtitle":"Events","operatorsInSubtitle":"Operators","eiisInSubtitle":"Explicit Interface Implementations","improveThisDoc":"Improve this Doc","viewSource":"View Source","inheritance":"Inheritance","inheritedMembers":"Inherited Members","namespace":"Namespace","assembly":"Assembly","syntax":"Syntax","overrides":"Overrides","implements":"Implements","remarks":"Remarks","examples":"Examples","seealso":"See Also","declaration":"Declaration","parameters":"Parameters","typeParameters":"Type Parameters","type":"Type","name":"Name","description":"Description","returns":"Returns","fieldValue":"Field Value","propertyValue":"Property Value","eventType":"Event Type","exceptions":"Exceptions","condition":"Condition","extensionMethods":"Extension Methods","note":"<h5>Note</h5>","warning":"<h5>Warning</h5>","tip":"<h5>Tip</h5>","important":"<h5>Important</h5>","caution":"<h5>Caution</h5>","_shared":{}},"_disableToc":false,"docurl":"https://github.com/dotnet/docfx/blob/doc/Documentation/tutorial/advanced_support_hyperlink.md/#L1"}